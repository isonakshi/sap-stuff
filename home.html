<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta name="generator" content=
  "HTML Tidy for Linux/x86 (vers 11 February 2007), see www.w3.org" />
<!--  <link rel="stylesheet" href="stylesheets/reset.css" type="text/css" media="screen" />
  <link rel="stylesheet" href="stylesheets/jive.css" type="text/css" media="screen" />
-->
<!--Jive.css-->
<style type="text/css">

/*Reset*/
/* http://meyerweb.com/eric/tools/css/reset/ 
   v2.0 | 20110126
   License: none (public domain)
*/

html, body, div, span, applet, object, iframe,
h1, h2, h3, h4, h5, h6, p, blockquote, pre,
a, abbr, acronym, address, big, cite, code,
del, dfn, em, img, ins, kbd, q, s, samp,
small, strike, strong, sub, sup, tt, var,
b, u, i, center,
dl, dt, dd, ol, ul, li,
fieldset, form, label, legend,
table, caption, tbody, tfoot, thead, tr, th, td,
article, aside, canvas, details, embed, 
figure, figcaption, footer, header, hgroup, 
menu, nav, output, ruby, section, summary,
time, mark, audio, video {
 margin: 0;
 padding: 0;
 border: 0;
 font-size: 100%;
 font: inherit;
 vertical-align: baseline;
}
/* HTML5 display-role reset for older browsers */
article, aside, details, figcaption, figure, 
footer, header, hgroup, menu, nav, section {
 display: block;
}
body {
 line-height: 1;
}
ol, ul {
 list-style: none;
}
blockquote, q {
 quotes: none;
}
blockquote:before, blockquote:after,
q:before, q:after {
 content: '';
 content: none;
}
table {
 border-collapse: collapse;
 border-spacing: 0;
 /*border-collapse: seperate;*/
}
/*Reset Ends*/

/*Jive style*/

html, body { font-family : "Helvetica Neue",Helvetica,Arial,sans-serif; font-size:7.5pt}

a:link, a:visited { color:#658AC3}
a:hover {text-decoration:none}

/* tables */ /* add to table - table-layout:fixed; */
table.data-grid, table.crud, table.banner {  border:1px solid #222; margin:20px; box-shadow:0 0 5px #888}
table.data-grid {width:90%}
table.data-grid thead tr th, table.crud thead tr th, table.banner thead tr th{ color:white; padding:8px 15px 8px 8px; text-align:left; font-weight:bold}
table.data-grid tbody tr td{ padding:2px; border-top:1px solid #222; cursor:default; text-align:left; overflow: hidden; position:relative;} /* for overflow -- text-overflow:ellipsis; white-space:nowrap; */
table.data-grid tbody tr:hover { background:#FFFF00}
table.data-grid tbody tr.active { background:#FFFF00; color:black}
table.data-grid tbody tr.active a:link, table.data-grid tbody tr.active a:visited { color:#658AC3}
table.crud tbody td { padding:5px; vertical-align:top}
table.crud tbody td.button_row{ 
text-align:center; vertical-align:center; margin: 1em 0; padding:0.3em;}
table.crud thead, table.data-grid thead tr th, table.data-grid tfoot tr th {
	background-color: #12378B;
	border: 1px solid #222;
}

table.data-grid thead tr .header {
	background-image: url(images/bg.png);
	background-repeat: no-repeat;
	background-position: center right;
	cursor: pointer;
}


td.noDiscuss {
	background-image: url(images/discuss_no.png);no-repeat left center; 
    padding-left: 18px; /* width of feed icon plus 2px spacing */
}
td.Discuss {
	background-image: url(images/discuss_yes.png);no-repeat left center; 
    padding-left: 18px; /* width of feed icon plus 2px spacing */
}

td.updateDays{
	background-image: url(images/updatedays.png);
}

td.updateMins{
	background-image: url(images/updatemins.png);
}

td.infoSR{
	background-image: url(images/info.png);no-repeat left center; 
    padding-left: 18px; /* width of feed icon plus 2px spacing */ 
}
td.Severity1{
	background-image: url(images/1critical.png);
}
td.Severity2{
	background-image: url(images/Red_Flag.png); no-repeat left center; 
    padding-left: 18px; /* width of feed icon plus 2px spacing */
}
td.Severity3{
	background-image: url(images/3medium.png);
}
td.Severity4{
	background-image: url(images/Blue_Flag.png); no-repeat left center; 
    padding-left: 18px; /* width of feed icon plus 2px spacing */
}

td.referSR{
	background-image: url(images/refer.png); no-repeat left center; 
    padding-left: 18px; /* width of feed icon plus 2px spacing */
}

/* adding td images */

td.img1 { 
    background: transparent url(images/img1.png);
}
td.img2 { 
    background: transparent url(images/img2.jpg);
}
td.img3 { 
    background: transparent url(images/Age.jpg);
}
td.img4 { 
    background: transparent url(images/img4.bmp);
}
td.img5 { 
    background: transparent url(images/img5.jpg); 
}
td.img6 { 
    background: transparent url(images/img6.png);
}
td.prob1 { 
    background: transparent url(images/red_circle.jpg);
}
td.prob2 { 
    background: transparent url(images/yellow_circle.jpg);
}
td.prob3 { 
    background: transparent url(images/blue_circle.jpg);
}
td.prob4 { 
    background: transparent url(images/green_circle.jpg);
}

/* end td images adding */

.button
{
	padding-top: 3px;
	padding-bottom: 3px;
	padding-right: 10px;
	padding-left: 10px;
	
	font-size: 9pt;
	font-weight:bold;
	text-decoration: none;
	color: white;
	background-color: #12378B;
	
	text-align: center;
	-moz-border-radius: 8px;
	-webkit-border-radius: 8px;	
}

.button:hover
{
background-color: #658AC3;
}

textarea.referMsg
{
	height:100px;
}
input, textarea, select { width:300px; padding:5px;}

td.noDiscuss, td.Discuss,td.prob1,td.prob2,td.prob3,td.prob4,td.img1,td.img2,td.img3,td.img4,td.img5,td.img6, td.updateDays, td.updateMins, td.infoSR, td.Severity1, td.Severity2, td.Severity3, td.Severity4, td.referSR
{
	background-repeat: no-repeat;
	background-position: center center;
    position:relative; /*this is the key*/
    z-index:24;
	
	width: 17px;
} /* padding: 2px 3px; */
td.noDiscuss:hover, td.Discuss:hover, td.updateDays:hover, td.updateMins:hover, td.infoSR:hover, td.Severity1:hover, td.Severity2:hover, td.Severity3:hover, td.Severity4:hover, td.referSR
{
	z-index:25;
}
td span {
	display:none;
}

td:hover span {
    display:block;
    position:absolute; top:80px; left:100px; width:150px;
    border:1px solid #FFF;
    background-color:#12378B; color:#FFF;
    text-align: left;
	/* outline radius for mozilla/firefox only */
	-moz-box-shadow:0 0 10px #000;
	-webkit-box-shadow:0 0 10px #000;	
}

a:link, a:visited { color:black}
a:hover {text-decoration:none}

a.viewmore:link, a.viewmore:visited
{
	padding-top: 3px;
	padding-bottom: 3px;
	padding-right: 10px;
	padding-left: 10px;
	
	font-size: 9pt;
	font-weight:bold;
	text-decoration: none;
	color: white;
	background-color: #12378B;
	
	text-align: center;
	-moz-border-radius: 8px;
	-webkit-border-radius: 8px;	
}

a.viewmore:hover
{
background-color: #658AC3;
}

#footer{
	clear: both;
	height: 28px;
	width: 100%;
	border-width: 1px 0 0 0;
	border-style: solid;
	border-color: #658AC3;
	vertical-align: middle;
	padding: 0;
	margin: 0;
	position: absolute;
	bottom: 0px;
	font-size: 9px;
	font-weight: bold;
	text-align:center;
	font-family: Verdana, Geneva, Arial, sans-serif
} 

/* Jive Style ends */

/*New Home */
* {
  margin: 0;
  padding: 0
}

.container {
  background-color: #12378B;
  width: 380px;
  border: 1px solid #000;
}

* html .container {
  width: 383px;
}

.header {
  width: 100%;
  border-bottom: 1px solid #000;
}

.header ul {
  list-style: none
}

.header ul li {
  width: 90px;
  border-left: 1px solid #000;
  float: left;
  font-weight: bold;
  padding-left: 2px;
}

* html .header ul li {
  width: 93px;
}

.data {
  width: 90px;
  overflow:hidden;
  text-overflow:ellipsis; 
  white-space:nowrap;
  float: left;
  padding-left: 2px;
}

* html .data {
  width: 93px;
}

.rowodd,.roweven {
  position: relative;
  width: 380px;
  border-top: 1px solid #000;
  background-color: #E8E8E8;
}

.roweven {
  background-color: #D1DCE9;
}

.clearfix:after {
  content: ".";
  display: block;
  height: 0;
  clear: both;
  visibility: hidden;
}

.clearfix {
  display: inline-block;
}
/*New Home Ends */
</style>

<title>My Opportunities - Home</title>
</head>
<body>

<div id="LoginScreen">
<table class="crud" id="loginForm" width="90%">
	<thead>
	  <tr>
		<th colspan="2">Login - Siebel Credentials</th>
	  </tr>
	</thead>
	<tbody>
		<tr><td>Username</td><td><input type="text" id="uname"/></td></tr>
		<tr><td>Password</td><td><input type="password" id="pword"/></td></tr>
		<tr><td class="button_row" colspan="2"><button id="loginSiebel">Submit</button><span>  </span><button id="cancelSiebel">Cancel</button>
		</td>
		</tr>
	</tbody>
</table>
</div>

<div id="HomeView">
  <button id="logOut">Logout</button>
  <table id="xmlTable" class="data-grid">
    <thead>
      <tr>
		<th>Opportunity Name</th>
		<th>Account</th>
		<th colspan="7" style="padding:8px 115px 8px 8px;">Info</th>
       </tr>
    </thead>
    <tbody id="TableBody">
      <!-- Placeholder for the fetched records to be displayed -->
    </tbody>
  </table>

</div>

<table class="crud" id="ReferPage" width="90%" style="display:none">
	<thead>
	  <tr>
		<th colspan="2">Refer Opportunity to a Colleague</th>
	  </tr>
	</thead>
	<tbody>
		<tr><td>To</td><td> <select id="referList"></select></td></tr>
		<tr><td>Subject</td><td><input type="text" id="referSub"/></td></tr>
		<tr><td>Message</td><td><textarea id="referMsg" rows="5"></textarea></td></tr>
		<tr><td class="button_row" colspan="2"><button id="postMsg">Post Message</button><span>  </span><button id="cancelMsg">Cancel</button>
		</td>
		</tr>
	</tbody>
</table>

<div id="footer">&copy; Accenture 2011</div> 

  <script type="text/javascript" src="javascripts/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/jquery.tablesorter.min.js"></script>
  <script type="text/javascript" src="javascripts/jquery.xml2json.js"></script>
  <script type="text/javascript">
  $(document).ready(function () 
  {
  
	var prefs = new gadgets.Prefs();
	var yourSiebelUser = prefs.getString("UserName"); 
	var viewer;
	var srNumberRefer = "";
	var SiebelUser = "";
	var SiebelPassword = "";
	var INITIALIZED = 0;
	
	console.log("Scene 1: "+yourSiebelUser);

	gadgets.util.registerOnLoadHandler(init);	
	
	if (yourSiebelUser == "")
	{
		console.log("Your login screen:");
		$('#LoginScreen').show();
		$('#HomeView').hide();
		$('#ReferPage').hide();	
	}
	else
	{
		SiebelUser = prefs.getString("UserName");
		SiebelPassword = prefs.getString("Password");
		$('#HomeView').show();
		$('#LoginScreen').hide();
		$('#ReferPage').hide();
		loadTheRecords();
	}
	
 	function init() {
		console.log("In init");
		registerEvents();
		viewer = opensocial.data.getDataContext().getDataSet('viewer');
		INITIALIZED = 1;
	};
	
	function registerEvents() {
		var groupID = "@friends";
		//console.log("Selecting people for groupID '" + groupID + "'");
		osapi.people.get({
		userId : '@me',
		groupId : groupID,
		fields : 'id,name,thumbnail_url,jive_enabled'
		}).execute(function(response) {
			//console.log("Select response is " + JSON.stringify(response));
			var html = "";
			if (response.list) {
				$.each(response.list, function(index, user) {
					if (user.jive_enabled) {html += "<option value=\""+user.id+"\">" + user.displayName + "</option>";}
				});
			}
			else {
				var user = response;
				if (user.jive_enabled) { html += "<option value=\""+user.id+"\">" + user.displayName + "</option>"; }
			}
			$("#referList").html("").html(html);
		});
	};	
	
	function loadTheRecords() 
	{
		console.log("In Loadtherecords");
		var xmlDoc = '';
		
		if (INITIALIZED == 0)
		{
			init();
		}
		
		osapi.jive.core.users.get({id: '@viewer'}).execute(function(response) 
		{
			if (!response.error) 
			{
				var jiveUser = response.data;
				var idUser = jiveUser.username;
				
				//console.log("id User:"+idUser);
				var idUserSiebel=idUser.toUpperCase(); //Siebel currently allows only names in uppercase!
				//var idUserSiebel='PRADEEP';
				var DateImage = "images/updatedays.png";
				
				var xmlInput ='<?xml version="1.0" encoding="UTF-8"?><soapenv:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:cus="http://siebel.com/CustomUI" xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/"><soapenv:Header/><soapenv:Body>    <cus:FINSANIRequestProvidersQueryByExample soapenv:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"><SiebelMessage xsi:type="opp:ListOfOpportunityInterfaceTopElmt" xmlns:opp="http://www.siebel.com/xml/Opportunity Interface"><ListOfOpportunityInterface xsi:type="opp:ListOfOpportunityInterface"><Opportunity xsi:type="opp:ArrayOfOpportunity" soapenc:arrayType="opp:Opportunity[]"/><Opportunity><Name>*</Name><Account/><Comments/><CurrencyCode/><Description/><PriorityFlag/><PrimaryRevenueAmount/><PrimaryRevenueCloseDate/><PrimaryRevenueWinProbability/><ProductName/><SalesStage>Data Entry</SalesStage><Id/><OpptyId/><RowId/></Opportunity></ListOfOpportunityInterface></SiebelMessage></cus:FINSANIRequestProvidersQueryByExample></soapenv:Body></soapenv:Envelope>';
				
				var xmlInput=xmlInput+"&UserName="+SiebelUser+"&Password="+SiebelPassword;
				console.log("Request XML:..."+xmlInput);
				
			osapi.jive.connects.get({
			  'alias' : 'accenture',
			  'format' : 'text',
			  'headers' : { 'Content-Type' : ['application/xml;charset=utf-8'], 'Accept-Language' : ['en-us']},
			  'params' : { 'SWEExtData' : xmlInput } // Jive Connects will URI encode values for you
			}).execute(function(response) 
			{
			if (!response.error) 
				{
						xmlDoc = response.content;
						try 
						{
							var myXML = xmlDoc;
							var xmlDoc = $.parseXML(myXML);
							var dummyParent = '';
							$myXML = $(xmlDoc);
							$dummyParent = $myXML.find('Opportunity');
							$returnSR = $dummyParent.find('Opportunity');
							var optyName, pblty, revnue, account, status, crDate, clDate, disc, row='' , opDisc, channel, upDate ,pdName, descr, priority, age ='';
							var ddiff ='';
							var j=0;
							$returnSR.each(function () 
							{
									if(j<15)
									{
										optyName = ($(this).children('Name').text());
										pdName = ($(this).children('ProductName').text());	
										descr = ($(this).children('Description').text());	
										pblty = ($(this).children('PrimaryRevenueWinProbability').text());
										revnue = ($(this).children('PrimaryRevenueAmount').text());
										account = ($(this).children('Account').text());
										status = ($(this).children('SalesStage').text());
										crDate = ($(this).children('PrimaryRevenueCloseDate').text());
										disc = ($(this).children('Comments').text());										
										upDate = ($(this).children('SCRMUpdate').text());	
										priority = ($(this).children('PriorityFlag').text());	
										
										clDate='';
										channel='';
										
										if (disc=='')
										{
											opDisc = '<td class="noDiscuss" ><span>No Discussion Exists</span></td>'; 
										}
										else
										{
											opDisc = '<td class="Discuss" onclick="window.open(\''+disc+'\')" style="cursor:hand;"><span>Discussion Exists. Click on icon to open.</span></td>'; 
										}
										
										ddiff = DateFormatFunc (crDate);
										
										var infOppty = '<td class="infoSR" ><span>Category: '+pdName+' | Revenue: '+revnue+'| Description: '+descr+' </span></td>';
										var revn = '<td class="img6" ><span> Revenue: '+ revnue +'</span></td>';
										var prob = '';
										var cdate = '<td class="img2"><span> Created Date: '+ crDate +'</span></td>';
										var age = '<td class="img3"><span>'+'Age: '+ddiff +' </span></td>';			
										var refer = '<td class="referSR"><span>Refer this Opportunity to a colleague</span></td>';
										
										if (priority == 'Y')
										{
											priority = '<td class="Severity4"><span>Priority: YES</span></td>';
										}
										else
										{
											priority = '<td><span style="z-index:25;">Priority: NO</span></td>';
										}
										
										if (pblty >= 70)
										{
											prob = '<td class="prob4"><span> Probability: '+ pblty +'</span></td>';
										}
										else if (pblty >= 30 && pblty <=70)
										{
											prob = '<td class="prob2"><span> Probability: '+ pblty +'</span></td>';
										}
										else if (pblty < 30)
										{
											prob = '<td class="prob3"><span> Probability: '+ pblty +'</span></td>';
										}

									   upDate = DateFormatFunc(upDate);
										 
										if (upDate.search(/day/i) != -1)
										{
											upDate ='<td class="updateDays"><span>Updated '+upDate+' ago</span></td>'; //Image for Days ago
										}
										else if (upDate.search(/hour/i) != -1)
										{
											upDate ='<td class="updateMins"><span>Updated '+upDate+' ago</span></td>'; //Image for Hours ago
										}
										else
										{
											upDate ='<td class="updateMins"><span>Updated '+upDate+' ago</span></td>'; //Image for Minutes/Seconds ago
										}	
											
										row = row + 
												'<tr id="'+optyName+'" align="center">' +
												'<td align="center" style="height:20px">' + optyName + '</td>' +
												'<td align="center" style="height:20px">' + account + '</td>' +
												 infOppty  +  prob + upDate + age + priority+ opDisc + refer + '</tr>';
										j++;
									}											
							});		
							$("table#xmlTable tbody").append(row);
						} 
						catch (err) 
						{
							$("table#xmlTable tbody").append('<tr align="center"><td colspan="9">Unable to fetch records now.</td></tr>');
						}
				}
				else
				{
					if (response.error.message === 'Connection reset')
					{
						window.location.reload();
					}
					else
					{
						$("table#xmlTable tbody").append('<tr align="center"><td colspan="9">Unable to fetch records now. Error:'+response.error.message+'</td></tr>');
					}
				}	
				});
			}
			else
			{
				$("table#xmlTable tbody").append('<tr align="center"><td colspan="9">Unable to fetch records now. Error:'+response.error.message+'</td></tr>');
			}
		});	
	};
	
	//Refer - Submit
	$('button#postMsg').live('click', function(){
			var PostID=$('#referList').val();
			var Msg = $('#referMsg').val();
			var subject = $('#referSub').val();
			var msg = new gadgets.MiniMessage();
			//console.log("Posting to:"+PostID)
	  		  var params = {
		      "userId":"@viewer",
		      "activity":{
		          "title":"Notification (Siebel SRs)",
		          "body":"{@actor} referred to {@target} about \"Opportunity# "+srNumberRefer+"\"",
		          "verb":["POST"],
		          "object":{
						"id":"badge/103",
						"summary":"<b>"+subject+"</b><br/>"+Msg,
						"title":"Subject:"+subject,
						"objectType":"badge"
		          },
		          "target":{"id":"urn:jiveObject:user/"+PostID}        
		       },
		       "groupId":"@self"
		    }
			osapi.activities.create(params).execute(function(response) {
				if (!response.error) {	
					msg.createTimerMessage("<div style='text-align:center;'>Notification posted successfully.</div>", 4);
					$('#HomeView').show();
					$('#ReferPage').hide();
					$('#referMsg').val("");
					$('#referSub').val("");	
					}
				else {
					msg.createTimerMessage("<div style='text-align:center;'>Unable to post. Please try again. <br/>Error: <i>"+response.error.message+"</i> </div>", 4);
					}
				});
	});

	//Cancel Message - Refer
	$('button#cancelMsg').live('click', function(){	
			$('#referMsg').val("");
			$('#referSub').val("");
			$('#HomeView').show();
			$('#ReferPage').hide();				
	});	
	
	//Login Form
	$('button#loginSiebel').live('click', function(){	
		var prefs = new gadgets.Prefs();
		yourSiebelUser = prefs.getString("UserName"); 
		//console.log("Your Old Siebel User name: "+yourSiebelUser);
		SiebelUser = $('#uname').val();
		prefs.set("UserName",SiebelUser);
		SiebelPassword = $('#pword').val(); //this needs to be encrypted
		prefs.set("Password",SiebelPassword);
		//console.log("Changed Siebel User name & Password:..."+SiebelUser+"...."+SiebelPassword);
		//$("table#xmlTable tbody").html('');
		$('#HomeView').show();
		$('#LoginScreen').hide();
		$('#ReferPage').hide();	
		$('#uname').val('');
		$('#pword').val('');
		loadTheRecords();
	});
	
	//Login cancellation
	$('button#cancelSiebel').live('click', function(){	
		$('#uname').val("");
		$('#pword').val("");
		//$('#LoginScreen').hide();
		//$('#HomeView').show();
	});	

	//Logout
	$('button#logOut').live('click', function(){	
		var prefs = new gadgets.Prefs();
		prefs.set("UserName","");
		prefs.set("Password","");
		console.log("You have been logged out.");
		document.getElementById('TableBody').innerHTML = "";
		$('#LoginScreen').show();
		$('#HomeView').hide();
		$('#ReferPage').hide();	
	});	
	
    function newPost(){
	//var tr = $(this).closest('tr'), id = tr[0].id;
			var PostID=$('#referList').val();
			var Msg = $('#referMsg').val();
			var subject = $('#referSub').val();
			var msg = new gadgets.MiniMessage();
			//console.log("Posting to:"+PostID)
			  var params = {
			  "userId":"@viewer",
			  "activity":{
				  "title":"Notification (Siebel Opportunities)",
				  "body":"{@actor} referred to {@target} about \""+subject+"\"",
				  "verb":["POST"],
				  "object":{
						"id":"badge/103",
						"summary":"<b>"+subject+"</b><br/>"+Msg,
						"title":"Subject:"+subject,
						"objectType":"badge"
				  },
				  "target":{"id":"urn:jiveObject:user/"+PostID}        
			   },
			   "groupId":"@self"
			}
			osapi.activities.create(params).execute(function(response) {
				if (!response.error) {	
					msg.createTimerMessage("<div style='text-align:center;'>Notification posted successfully.</div>", 4);
					$('#HomeView').show();
					$('#ReferPage').hide();
					$('#referMsg').val("");
					$('#referSub').val("");	
					}
				else {
					msg.createTimerMessage("<div style='text-align:center;'>Unable to post. Please try again. <br />Error: <i>"+response.error.message+"</i> </div>", 4);
					}
				});
	};
	
	function cancelPost() {
			$('#referMsg').val("");
			$('#referSub').val("");
			$('#HomeView').show();
			$('#ReferPage').hide();	
	};
	
	function DateFormatFunc(InputDate)
	{
		var DtFmt = new Date(InputDate.substring(6,10),InputDate.substring(0,2)-1,InputDate.substring(3,5),InputDate.substring(11,13),InputDate.substring(14,16),InputDate.substring(17,19)).valueOf();
		var d = new Date();
		var DtCurr = new Date(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours(),d.getMinutes(),d.getSeconds()).valueOf();
		var timediff = Math.abs(DtCurr - DtFmt);
		var days = Math.floor(timediff / (1000 * 60 * 60 * 24)); 
		timediff -= days * (1000 * 60 * 60 * 24);
		var hours = Math.floor(timediff / (1000 * 60 * 60)); 
		timediff -= hours * (1000 * 60 * 60);
		hours = hours - 12; //as it is IST now.
		var mins = Math.floor(timediff / (1000 * 60)); 
		timediff -= mins * (1000 * 60);
		mins = mins - 30; //IST correction
		var secs = Math.floor(timediff / 1000); 
		timediff -= secs * 1000;
		var dtfmtDate = days +":" + hours +":"+mins +":"+secs
		if (days > 0)
		{
			if (days == 1)
			{ return "1 day";}
			else
			{ return days+" days"; }
		}
		else if (days === 0)
		{
			if (hours > 0)
			{	
				if (hours == 1)
				{return "1 hr";}
				else
				{return hours+" hrs"; }
			}
			else if (mins > 0)
			{	
				if (mins == 1)
				{ return "1 min"; }
				else
				{return mins+" mins"; }
			}
			else
			{	return secs+" secs"; }
		}
		return (dtfmtDate);
	};
	
	$("td.referSR").live('click', function(){
			var tr = $(this).closest('tr'), id = tr[0].id;
			srNumberRefer = id;
			//console.log("ID:"+id);
			if(INITIALIZED == 0)
			{ init(); }
			$('#HomeView').hide();
			$('#ReferPage').show();	
	});
});
</script>
</body>
</html>